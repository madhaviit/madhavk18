<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: March 14, 2023 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/madhavk18/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/madhavk18/css/wowchemy.0f229d4b7ebad1917a9a357cba2effab.css><link rel=stylesheet href=/madhavk18/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/madhavk18/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="Madhav Kadam"><meta name=description content="In this notebook my team explains how to use our pipeline for getting infernece. Imports Section !pip install ultralytics import ultralytics from ultralytics import YOLO import numpy as np import cv2 as cv !"><link rel=alternate hreflang=en-us href=https://madhaviit.github.io/madhavk18/post/vitals_notebook/><link rel=canonical href=https://madhaviit.github.io/madhavk18/post/vitals_notebook/><link rel=manifest href=/madhavk18/manifest.webmanifest><link rel=icon type=image/png href=/madhavk18/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/madhavk18/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wowchemy"><meta property="twitter:creator" content="@wowchemy"><meta property="twitter:image" content="https://madhaviit.github.io/madhavk18/post/vitals_notebook/featured.png"><meta property="og:site_name" content="Academic"><meta property="og:url" content="https://madhaviit.github.io/madhavk18/post/vitals_notebook/"><meta property="og:title" content="Code for inference in Vitals Extraction Chaallenge | Academic"><meta property="og:description" content="In this notebook my team explains how to use our pipeline for getting infernece. Imports Section !pip install ultralytics import ultralytics from ultralytics import YOLO import numpy as np import cv2 as cv !"><meta property="og:image" content="https://madhaviit.github.io/madhavk18/post/vitals_notebook/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-03-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-11T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://madhaviit.github.io/madhavk18/post/vitals_notebook/"},"headline":"Code for inference in Vitals Extraction Chaallenge","image":["https://madhaviit.github.io/madhavk18/post/vitals_notebook/featured.png"],"datePublished":"2023-03-11T00:00:00Z","dateModified":"2023-03-11T00:00:00Z","author":{"@type":"Person","name":"Madhav Kadam"},"publisher":{"@type":"Organization","name":"Academic","logo":{"@type":"ImageObject","url":"https://madhaviit.github.io/madhavk18/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"}},"description":"In this notebook my team explains how to use our pipeline for getting infernece. Imports Section !pip install ultralytics import ultralytics from ultralytics import YOLO import numpy as np import cv2 as cv !"}</script><title>Code for inference in Vitals Extraction Chaallenge | Academic</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=6a6ac0dabb5aa13c1d9831739bffa7d9><script src=/madhavk18/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/madhavk18/>Academic</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/madhavk18/>Academic</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/madhavk18/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/madhavk18/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/madhavk18/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/madhavk18/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/madhavk18/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/madhavk18/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item d-none d-lg-inline-flex"><a class=nav-link href=https://twitter.com/mkiitind data-toggle=tooltip data-placement=bottom title="Follow me on Twitter" target=_blank rel=noopener aria-label="Follow me on Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Code for inference in Vitals Extraction Chaallenge</h1><p class=page-subtitle>In this notebook my team explains how to use our pipeline for getting infernece.</p><div class=article-metadata><span class=article-date>Mar 11, 2023</span>
<span class=middot-divider></span>
<span class=article-reading-time>8 min read</span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:516px><div style=position:relative><img src=/madhavk18/post/vitals_notebook/featured_hue4444ab39c917427a2c0c5101d9f7ead_9843344_720x2500_fit_q75_h2_lanczos_3.webp width=720 height=516 alt class=featured-image></div></div><div class=article-container><div class=article-style><h1 id=in-this-notebook-my-team-explains-how-to-use-our-pipeline-for-getting-infernece>In this notebook my team explains how to use our pipeline for getting infernece.</h1><h1 id=imports-section>Imports Section</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=err>!</span><span class=n>pip</span> <span class=n>install</span> <span class=n>ultralytics</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>ultralytics</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>ultralytics</span> <span class=kn>import</span> <span class=n>YOLO</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cv2</span> <span class=k>as</span> <span class=nn>cv</span>
</span></span><span class=line><span class=cl><span class=err>!</span><span class=n>pip</span> <span class=n>install</span> <span class=s2>&#34;paddleocr==2.2&#34;</span>
</span></span><span class=line><span class=cl><span class=err>!</span><span class=n>pip</span> <span class=n>install</span> <span class=n>paddlepaddle</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span> 
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>paddleocr</span> <span class=kn>import</span> <span class=n>PaddleOCR</span><span class=p>,</span><span class=n>draw_ocr</span>
</span></span></code></pre></div><h1 id=helper-function-definition>Helper Function Definition</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Orders points in a particular way</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>order_points</span><span class=p>(</span><span class=n>pts</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>dtype</span> <span class=o>=</span> <span class=s2>&#34;float32&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>pts</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>pts</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>argmin</span><span class=p>(</span><span class=n>s</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>pts</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>s</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>diff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>pts</span><span class=p>,</span> <span class=n>axis</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>pts</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>argmin</span><span class=p>(</span><span class=n>diff</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>pts</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>diff</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>-=</span><span class=mi>5</span> <span class=c1>#if rect[0][0]&gt;=5 else rect[0][0]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>-=</span><span class=mi>5</span> <span class=c1>#if rect[0][1]&gt;=5 else rect[0][1]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>+=</span><span class=mi>5</span> <span class=c1>#if rect[2][0]&lt;=x-5 else rect[2][0]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>+=</span><span class=mi>5</span> <span class=c1>#if rect[2][1]&lt;=y-5 else rect[2][1]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>+=</span><span class=mi>5</span> <span class=c1>#if rect[1][0]&lt;=x-5 else rect[1][0]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>-=</span><span class=mi>5</span> <span class=c1>#if rect[1][1]&gt;=5 else rect[1][1]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>-=</span><span class=mi>5</span> <span class=c1>#if rect[3][0]&gt;=5 else rect[3][0]</span>
</span></span><span class=line><span class=cl>    <span class=n>rect</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=o>+=</span><span class=mi>5</span> <span class=c1>#if rect[3][1]&lt;=y-5 else rect[3][1]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>rect</span>
</span></span></code></pre></div><h1 id=inference-function>Inference Function</h1><p>Extract the model files from the zip files, and upload to colab.</p><p>Then add the filepaths.</p><p>seg_path should contain the path to the weights of the segmentation model.</p><p>det_path should contain the path to the weights of the detection model.</p><p>Run the below cell to load models. Then the inference function can be used.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>seg_model</span><span class=o>=</span><span class=n>YOLO</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>det_model</span><span class=o>=</span><span class=n>YOLO</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>name_dict</span><span class=o>=</span><span class=n>det_model</span><span class=o>.</span><span class=n>names</span>
</span></span><span class=line><span class=cl><span class=n>ocr</span><span class=o>=</span><span class=n>PaddleOCR</span><span class=p>(</span><span class=n>use_angle_cls</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>lang</span><span class=o>=</span><span class=s1>&#39;en&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Namespace(benchmark=False, cls_batch_num=6, cls_image_shape=&#39;3, 48, 192&#39;, cls_model_dir=&#39;/root/.paddleocr/2.2/ocr/cls/ch_ppocr_mobile_v2.0_cls_infer&#39;, cls_thresh=0.9, cpu_threads=10, det=True, det_algorithm=&#39;DB&#39;, det_db_box_thresh=0.5, det_db_score_mode=&#39;fast&#39;, det_db_thresh=0.3, det_db_unclip_ratio=1.6, det_east_cover_thresh=0.1, det_east_nms_thresh=0.2, det_east_score_thresh=0.8, det_limit_side_len=960, det_limit_type=&#39;max&#39;, det_model_dir=&#39;/root/.paddleocr/2.2/ocr/det/en/en_ppocr_mobile_v2.0_det_infer&#39;, det_sast_nms_thresh=0.2, det_sast_polygon=False, det_sast_score_thresh=0.5, drop_score=0.5, e2e_algorithm=&#39;PGNet&#39;, e2e_char_dict_path=&#39;./ppocr/utils/ic15_dict.txt&#39;, e2e_limit_side_len=768, e2e_limit_type=&#39;max&#39;, e2e_model_dir=None, e2e_pgnet_mode=&#39;fast&#39;, e2e_pgnet_polygon=True, e2e_pgnet_score_thresh=0.5, e2e_pgnet_valid_set=&#39;totaltext&#39;, enable_mkldnn=False, gpu_mem=500, help=&#39;==SUPPRESS==&#39;, image_dir=None, ir_optim=True, label_list=[&#39;0&#39;, &#39;180&#39;], lang=&#39;en&#39;, layout_path_model=&#39;lp://PubLayNet/ppyolov2_r50vd_dcn_365e_publaynet/config&#39;, max_batch_size=10, max_text_length=25, min_subgraph_size=10, output=&#39;./output/table&#39;, precision=&#39;fp32&#39;, process_id=0, rec=True, rec_algorithm=&#39;CRNN&#39;, rec_batch_num=6, rec_char_dict_path=&#39;/usr/local/lib/python3.8/dist-packages/paddleocr/ppocr/utils/en_dict.txt&#39;, rec_char_type=&#39;ch&#39;, rec_image_shape=&#39;3, 32, 320&#39;, rec_model_dir=&#39;/root/.paddleocr/2.2/ocr/rec/en/en_number_mobile_v2.0_rec_infer&#39;, save_log_path=&#39;./log_output/&#39;, show_log=True, table_char_dict_path=None, table_char_type=&#39;en&#39;, table_max_len=488, table_model_dir=None, total_process_num=1, type=&#39;ocr&#39;, use_angle_cls=True, use_dilation=False, use_gpu=True, use_mp=False, use_pdserving=False, use_space_char=True, use_tensorrt=False, vis_font_path=&#39;./doc/fonts/simfang.ttf&#39;, warmup=True)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># The function below takes in a path to an image, or a numpy array and returns a dictionary with the values read from the image</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inference</span><span class=p>(</span><span class=n>image</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>name_dict</span><span class=o>=</span><span class=n>det_model</span><span class=o>.</span><span class=n>names</span>
</span></span><span class=line><span class=cl>  <span class=c1># Initialize dictionaries</span>
</span></span><span class=line><span class=cl>  <span class=n>labels</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>confidence</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;HR&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;RR&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;SBP&#39;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;DBP&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;SPO2&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;MAP&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;HR_W&#39;</span><span class=p>:</span><span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>image</span><span class=p>,</span><span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>image</span><span class=p>,</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>=</span><span class=n>image</span>
</span></span><span class=line><span class=cl>  <span class=c1># Get segmentation predictions</span>
</span></span><span class=line><span class=cl>  <span class=n>results</span> <span class=o>=</span> <span class=n>seg_model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>img</span><span class=p>,</span><span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1># If segmention masks returned are not empty (i.e if image is not already segmented)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>!=</span><span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Get segments and crop image</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>=</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>masks</span><span class=o>.</span><span class=n>segments</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># Approximate segmentation segments with a quadrilateral</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>approxPolyDP</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=mf>0.04</span> <span class=o>*</span> <span class=n>cv</span><span class=o>.</span><span class=n>arcLength</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Order corners of the quadrilateral in a particular order</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span><span class=o>=</span><span class=n>order_points</span><span class=p>(</span><span class=n>u</span><span class=p>,</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>size_x</span><span class=o>=</span><span class=mi>720</span>
</span></span><span class=line><span class=cl>    <span class=n>size_y</span><span class=o>=</span><span class=mi>512</span>
</span></span><span class=line><span class=cl>    <span class=n>pts2</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=n>size_x</span><span class=p>,</span> <span class=mi>0</span><span class=p>],[</span><span class=n>size_x</span><span class=p>,</span> <span class=n>size_y</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>size_y</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>    <span class=c1># Apply perspective transform on the image to get an image to perform detection on</span>
</span></span><span class=line><span class=cl>    <span class=n>matrix</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>getPerspectiveTransform</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>),</span> <span class=n>pts2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>seg</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>warpPerspective</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>matrix</span><span class=p>,</span> <span class=p>(</span><span class=n>size_x</span><span class=p>,</span> <span class=n>size_y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=c1># If the image is already segmented then just run the image through detection</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>seg</span><span class=o>=</span><span class=n>img</span>
</span></span><span class=line><span class=cl>  <span class=c1># Perform detetection with the detection model</span>
</span></span><span class=line><span class=cl>  <span class=n>det</span><span class=o>=</span><span class=n>det_model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>seg</span><span class=p>,</span><span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>boxes</span>
</span></span><span class=line><span class=cl>  <span class=n>detxy</span><span class=o>=</span><span class=p>(</span><span class=n>det</span><span class=o>.</span><span class=n>xyxy</span><span class=o>.</span><span class=n>numpy</span><span class=p>())</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>detcls</span><span class=o>=</span><span class=n>det</span><span class=o>.</span><span class=n>cls</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>detconf</span><span class=o>=</span><span class=n>det</span><span class=o>.</span><span class=n>conf</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1># Iterate over regions of interest detected and acquire OCR results, use highest confidence for each class</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>detcls</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>!=</span><span class=s1>&#39;HR_W&#39;</span> <span class=ow>and</span> <span class=n>confidence</span><span class=p>[</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>&lt;</span><span class=n>detconf</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>      <span class=n>bb</span><span class=o>=</span><span class=n>seg</span><span class=p>[</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>]:</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=p>],</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>]:</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>      <span class=n>ocrres</span><span class=o>=</span><span class=n>ocr</span><span class=o>.</span><span class=n>ocr</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>det</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rec</span><span class=o>=</span> <span class=kc>True</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>procres</span><span class=o>=</span><span class=n>ocrres</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>confidence</span><span class=p>[</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>=</span><span class=n>detconf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>ocrres</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&gt;</span><span class=mf>0.6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Process OCR result to correct some faults</span>
</span></span><span class=line><span class=cl>        <span class=n>pred</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>procres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span><span class=o>&gt;=</span><span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span><span class=o>&lt;=</span><span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;9&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>pred</span><span class=o>+=</span><span class=n>char</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;A&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;4&#39;</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;T&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;7&#39;</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;O&#39;</span><span class=ow>or</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;o&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>=</span> <span class=n>pred</span>
</span></span><span class=line><span class=cl>  <span class=c1># Applying checks to correct common faults</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>])</span><span class=o>&lt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>])</span><span class=o>&gt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>!=</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>])</span><span class=o>&lt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=o>+</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>!=</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>])</span><span class=o>&gt;</span><span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>])</span> <span class=ow>and</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>==</span><span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>      <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>  <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>labels</span>
</span></span></code></pre></div><h1 id=hr-digitization-function>HR digitization function</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># HR digitization. This function takes in a numpy array of the HR graph image. The Class function method below will take in an image of the monitor and give graph as well as inference.</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>digitize</span><span class=p>(</span><span class=n>img</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=c1># convert the input image to grayscale</span>
</span></span><span class=line><span class=cl>  <span class=n>gray</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2GRAY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1># apply thresholding to convert grayscale to binary image</span>
</span></span><span class=line><span class=cl>  <span class=n>ret</span><span class=p>,</span><span class=n>thresh</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>threshold</span><span class=p>(</span><span class=n>gray</span><span class=p>,</span><span class=mi>120</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1># convert BGR to RGB to display using matplotlib</span>
</span></span><span class=line><span class=cl>  <span class=n>imgRGB</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2RGB</span><span class=p>)</span><span class=c1># display Original, Grayscale and Binary Images</span>
</span></span><span class=line><span class=cl>  <span class=n>Npixels_rate</span><span class=p>,</span><span class=n>Npixels_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>shape</span><span class=p>(</span><span class=n>thresh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>#Selecting the longest chain of connected components</span>
</span></span><span class=line><span class=cl>  <span class=n>length_subarray</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_rate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>   <span class=n>length_subarray</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh</span><span class=p>[</span><span class=n>col</span><span class=p>,:]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>max_index</span><span class=o>=</span><span class=n>length_subarray</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_index</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>&gt;</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>i</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>min_val</span><span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>max_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  <span class=n>min_index</span><span class=o>=</span><span class=n>length_subarray</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>max_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>new_length_subarray</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>min_index</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>new_length_subarray</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>thresh_crop</span><span class=o>=</span><span class=n>thresh</span><span class=p>[</span><span class=n>min_index</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>:</span><span class=n>Npixels_time</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>new_rate</span><span class=p>,</span><span class=n>new_time</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>shape</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=c1>#Extract the time series (not the scale bars) by starting in the first column</span>
</span></span><span class=line><span class=cl>  <span class=n>col_in_time_series</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>  <span class=n>s1rate_pixelss</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=n>col</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>[:,</span><span class=n>col</span><span class=p>]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=n>s1rate_pixelss</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>[:,</span><span class=n>col</span><span class=p>]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>  <span class=n>s1rate_pixelss</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Visualize time series</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mf>3.8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>,</span><span class=s1>&#39;k&#39;</span><span class=p>,</span><span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>xlim</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_time</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>ylim</span><span class=p>((</span><span class=n>new_rate</span><span class=p>,</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Time (pixels)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Heart rate Voltage(pixels)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Time Series Signal of HR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Scaling the heart rate voltage</span>
</span></span><span class=line><span class=cl>  <span class=n>s1rate</span> <span class=o>=</span> <span class=n>s1rate_pixelss</span><span class=o>*</span><span class=mf>0.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Convert time from pixels to ms</span>
</span></span><span class=line><span class=cl>  <span class=n>pixels</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>t</span> <span class=o>=</span> <span class=n>pixels</span><span class=o>*</span><span class=mf>0.02</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Visualize re-scaled time series</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>s1rate</span><span class=p>,</span><span class=s1>&#39;k&#39;</span><span class=p>,</span><span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>gca</span><span class=p>()</span><span class=o>.</span><span class=n>invert_yaxis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Scaled Time Series Signal of HR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Time (sec)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Heart rate Voltage (mV)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>()</span>
</span></span></code></pre></div><p>Imgpath should contain path to image</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>inf</span><span class=o>=</span><span class=n>inference</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inf</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#39;SPO2&#39;: &#39;100&#39;, &#39;HR&#39;: &#39;81&#39;, &#39;SBP&#39;: &#39;131&#39;, &#39;DBP&#39;: &#39;83&#39;, &#39;MAP&#39;: &#39;94&#39;, &#39;RR&#39;: &#39;12&#39;}
</span></span></code></pre></div><h1 id=class-for-inference>Class for inference</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>extraction</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1># Object initialization</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seg_path</span><span class=p>,</span> <span class=n>det_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>seg_model</span><span class=o>=</span><span class=n>YOLO</span><span class=p>(</span><span class=n>seg_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>det_model</span><span class=o>=</span><span class=n>YOLO</span><span class=p>(</span><span class=n>det_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>det_model</span><span class=o>.</span><span class=n>names</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>ocr</span><span class=o>=</span><span class=n>PaddleOCR</span><span class=p>(</span><span class=n>use_angle_cls</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>lang</span><span class=o>=</span><span class=s1>&#39;en&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Inference function</span>
</span></span><span class=line><span class=cl>    <span class=c1># The function below takes in a path to an image, or a numpy array and returns a dictionary with the values read from the image.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>inference</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;labels&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Initialize dictionaries</span>
</span></span><span class=line><span class=cl>    <span class=n>labels</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>confidence</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;HR&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;RR&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;SBP&#39;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;DBP&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;SPO2&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;MAP&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;HR_W&#39;</span><span class=p>:</span><span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>image</span><span class=p>,</span><span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>img</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>image</span><span class=p>,</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>img</span><span class=o>=</span><span class=n>image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get segmentation predictions</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>seg_model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>img</span><span class=p>,</span><span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># If segmention masks returned are not empty (i.e if image is not already segmented)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>!=</span><span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Get segments and crop image</span>
</span></span><span class=line><span class=cl>      <span class=n>t</span><span class=o>=</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>masks</span><span class=o>.</span><span class=n>segments</span>
</span></span><span class=line><span class=cl>      <span class=n>t</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>      <span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>][:,</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>      <span class=n>c</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Approximate segmentation segments with a quadrilateral</span>
</span></span><span class=line><span class=cl>      <span class=n>u</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>approxPolyDP</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=mf>0.04</span> <span class=o>*</span> <span class=n>cv</span><span class=o>.</span><span class=n>arcLength</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Order corners of the quadrilateral in a particular order</span>
</span></span><span class=line><span class=cl>      <span class=n>u</span><span class=o>=</span><span class=n>order_points</span><span class=p>(</span><span class=n>u</span><span class=p>,</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>      <span class=n>size_x</span><span class=o>=</span><span class=mi>720</span>
</span></span><span class=line><span class=cl>      <span class=n>size_y</span><span class=o>=</span><span class=mi>512</span>
</span></span><span class=line><span class=cl>      <span class=n>pts2</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=n>size_x</span><span class=p>,</span> <span class=mi>0</span><span class=p>],[</span><span class=n>size_x</span><span class=p>,</span> <span class=n>size_y</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>size_y</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Apply perspective transform on the image to get an image to perform detection on</span>
</span></span><span class=line><span class=cl>      <span class=n>matrix</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>getPerspectiveTransform</span><span class=p>(</span><span class=n>u</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>),</span> <span class=n>pts2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>seg</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>warpPerspective</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>matrix</span><span class=p>,</span> <span class=p>(</span><span class=n>size_x</span><span class=p>,</span> <span class=n>size_y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># If the image is already segmented then just run the image through detection</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>seg</span><span class=o>=</span><span class=n>img</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Perform detetection with the detection model</span>
</span></span><span class=line><span class=cl>    <span class=n>det</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>det_model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>seg</span><span class=p>,</span><span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>boxes</span>
</span></span><span class=line><span class=cl>    <span class=n>detxy</span><span class=o>=</span><span class=p>(</span><span class=n>det</span><span class=o>.</span><span class=n>xyxy</span><span class=o>.</span><span class=n>numpy</span><span class=p>())</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>detcls</span><span class=o>=</span><span class=n>det</span><span class=o>.</span><span class=n>cls</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>detconf</span><span class=o>=</span><span class=n>det</span><span class=o>.</span><span class=n>conf</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Iterate over regions of interest detected and acquire OCR results if mode=&#39;labels&#39;, else if mode= &#39;graphs&#39; plots a graph, use highest confidence for each class</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>detcls</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Graph digitization function, only when mode=&#39;graphs&#39;. Plots a graph</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>==</span> <span class=s1>&#39;HR_W&#39;</span> <span class=ow>and</span> <span class=n>confidence</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>&lt;</span><span class=n>detconf</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mode</span><span class=o>==</span><span class=s1>&#39;graph&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>hr_graph</span> <span class=o>=</span> <span class=n>seg</span><span class=p>[</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>]:</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=p>],</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>]:</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>digitize</span><span class=p>(</span><span class=n>hr_graph</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1># Default case, returns dictionary with detected values</span>
</span></span><span class=line><span class=cl>      <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>!=</span> <span class=s1>&#39;HR_W&#39;</span> <span class=ow>and</span> <span class=n>confidence</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>&lt;</span><span class=n>detconf</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>bb</span><span class=o>=</span><span class=n>seg</span><span class=p>[</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>]:</span><span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=p>],</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>0</span><span class=p>]:</span> <span class=n>detxy</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=mi>2</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Get OCR result</span>
</span></span><span class=line><span class=cl>        <span class=n>ocrres</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ocr</span><span class=o>.</span><span class=n>ocr</span><span class=p>(</span><span class=n>bb</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>det</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rec</span><span class=o>=</span> <span class=kc>True</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>procres</span><span class=o>=</span><span class=n>ocrres</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>confidence</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>=</span><span class=n>detconf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ocrres</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>&gt;</span><span class=mf>0.6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1># Process OCR result to correct some faults</span>
</span></span><span class=line><span class=cl>          <span class=n>pred</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>procres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span><span class=o>&gt;=</span><span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span><span class=o>&lt;=</span><span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;9&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>              <span class=n>pred</span><span class=o>+=</span><span class=n>char</span>
</span></span><span class=line><span class=cl>              <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;A&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;4&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;T&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;7&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;O&#39;</span><span class=ow>or</span> <span class=n>char</span><span class=o>==</span><span class=s1>&#39;o&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>pred</span><span class=o>+=</span><span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>name_dict</span><span class=p>[</span><span class=n>j</span><span class=p>]]</span><span class=o>=</span> <span class=n>pred</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Applying checks to correct common faults</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>])</span><span class=o>&lt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>])</span><span class=o>&gt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;RR&#39;</span><span class=p>],</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SPO2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>!=</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>])</span><span class=o>&lt;</span><span class=mi>50</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=o>+</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>]</span><span class=o>!=</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>!=</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>])</span><span class=o>&gt;</span><span class=nb>int</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;SBP&#39;</span><span class=p>])</span> <span class=ow>and</span> <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>==</span><span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>labels</span><span class=p>[</span><span class=s1>&#39;DBP&#39;</span><span class=p>]</span><span class=o>=</span><span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>labels</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># HR Graph Digitization Function</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>digitize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>img</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># convert the input image to grayscale</span>
</span></span><span class=line><span class=cl>    <span class=n>gray</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2GRAY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># apply thresholding to convert grayscale to binary image</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span><span class=p>,</span><span class=n>thresh</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>threshold</span><span class=p>(</span><span class=n>gray</span><span class=p>,</span><span class=mi>120</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># convert BGR to RGB to display using matplotlib</span>
</span></span><span class=line><span class=cl>    <span class=n>imgRGB</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2RGB</span><span class=p>)</span><span class=c1># display Original, Grayscale and Binary Images</span>
</span></span><span class=line><span class=cl>    <span class=n>Npixels_rate</span><span class=p>,</span><span class=n>Npixels_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>shape</span><span class=p>(</span><span class=n>thresh</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#Selecting the longest chain of connected components</span>
</span></span><span class=line><span class=cl>    <span class=n>length_subarray</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_rate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>length_subarray</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh</span><span class=p>[</span><span class=n>col</span><span class=p>,:]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>max_index</span><span class=o>=</span><span class=n>length_subarray</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_index</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>&gt;</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>i</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>min_val</span><span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>max_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>min_index</span><span class=o>=</span><span class=n>length_subarray</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>max_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>new_length_subarray</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>min_index</span><span class=p>,</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>new_length_subarray</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>length_subarray</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>thresh_crop</span><span class=o>=</span><span class=n>thresh</span><span class=p>[</span><span class=n>min_index</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>:</span><span class=n>Npixels_time</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>new_rate</span><span class=p>,</span><span class=n>new_time</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>shape</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>#Extract the time series (not the scale bars) by starting in the first column</span>
</span></span><span class=line><span class=cl>    <span class=n>col_in_time_series</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>s1rate_pixelss</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>col</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>[:,</span><span class=n>col</span><span class=p>]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>          <span class=n>s1rate_pixelss</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>thresh_crop</span><span class=p>[:,</span><span class=n>col</span><span class=p>]</span><span class=o>==</span><span class=mi>255</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=n>s1rate_pixelss</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Visualize time series</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mf>3.8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>,</span><span class=s1>&#39;k&#39;</span><span class=p>,</span><span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlim</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span><span class=n>Npixels_time</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylim</span><span class=p>((</span><span class=n>new_rate</span><span class=p>,</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Time (pixels)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Heart rate Voltage(pixels)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Time Series Signal of HR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Scaling the heart rate voltage</span>
</span></span><span class=line><span class=cl>    <span class=n>s1rate</span> <span class=o>=</span> <span class=n>s1rate_pixelss</span><span class=o>*</span><span class=mf>0.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Convert time from pixels to ms</span>
</span></span><span class=line><span class=cl>    <span class=n>pixels</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>s1rate_pixelss</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>pixels</span><span class=o>*</span><span class=mf>0.02</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Visualize re-scaled time series</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>s1rate</span><span class=p>,</span><span class=s1>&#39;k&#39;</span><span class=p>,</span><span class=n>linewidth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>gca</span><span class=p>()</span><span class=o>.</span><span class=n>invert_yaxis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Scaled Time Series Signal of HR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Time (sec)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Heart rate Voltage (mV)&#39;</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=how-to-use>How to Use:</h1><p>First, create an object as follows (Run the below cell) :</p><p>This step will take some time, it will load the weights and download weights for the OCR model.
Add the model files from the zip, and upload to colab.</p><p>Then add the filepaths.</p><p>seg_path should contain the path to the weights of the segmentation model.</p><p>det_path should contain the path to the weights of the detection model.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>seg_path</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>det_path</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Initialize object</span>
</span></span><span class=line><span class=cl><span class=n>extr</span> <span class=o>=</span> <span class=n>extraction</span><span class=p>(</span><span class=n>seg_path</span><span class=p>,</span> <span class=n>det_path</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Namespace(benchmark=False, cls_batch_num=6, cls_image_shape=&#39;3, 48, 192&#39;, cls_model_dir=&#39;/root/.paddleocr/2.2/ocr/cls/ch_ppocr_mobile_v2.0_cls_infer&#39;, cls_thresh=0.9, cpu_threads=10, det=True, det_algorithm=&#39;DB&#39;, det_db_box_thresh=0.5, det_db_score_mode=&#39;fast&#39;, det_db_thresh=0.3, det_db_unclip_ratio=1.6, det_east_cover_thresh=0.1, det_east_nms_thresh=0.2, det_east_score_thresh=0.8, det_limit_side_len=960, det_limit_type=&#39;max&#39;, det_model_dir=&#39;/root/.paddleocr/2.2/ocr/det/en/en_ppocr_mobile_v2.0_det_infer&#39;, det_sast_nms_thresh=0.2, det_sast_polygon=False, det_sast_score_thresh=0.5, drop_score=0.5, e2e_algorithm=&#39;PGNet&#39;, e2e_char_dict_path=&#39;./ppocr/utils/ic15_dict.txt&#39;, e2e_limit_side_len=768, e2e_limit_type=&#39;max&#39;, e2e_model_dir=None, e2e_pgnet_mode=&#39;fast&#39;, e2e_pgnet_polygon=True, e2e_pgnet_score_thresh=0.5, e2e_pgnet_valid_set=&#39;totaltext&#39;, enable_mkldnn=False, gpu_mem=500, help=&#39;==SUPPRESS==&#39;, image_dir=None, ir_optim=True, label_list=[&#39;0&#39;, &#39;180&#39;], lang=&#39;en&#39;, layout_path_model=&#39;lp://PubLayNet/ppyolov2_r50vd_dcn_365e_publaynet/config&#39;, max_batch_size=10, max_text_length=25, min_subgraph_size=10, output=&#39;./output/table&#39;, precision=&#39;fp32&#39;, process_id=0, rec=True, rec_algorithm=&#39;CRNN&#39;, rec_batch_num=6, rec_char_dict_path=&#39;/usr/local/lib/python3.8/dist-packages/paddleocr/ppocr/utils/en_dict.txt&#39;, rec_char_type=&#39;ch&#39;, rec_image_shape=&#39;3, 32, 320&#39;, rec_model_dir=&#39;/root/.paddleocr/2.2/ocr/rec/en/en_number_mobile_v2.0_rec_infer&#39;, save_log_path=&#39;./log_output/&#39;, show_log=True, table_char_dict_path=None, table_char_type=&#39;en&#39;, table_max_len=488, table_model_dir=None, total_process_num=1, type=&#39;ocr&#39;, use_angle_cls=True, use_dilation=False, use_gpu=True, use_mp=False, use_pdserving=False, use_space_char=True, use_tensorrt=False, vis_font_path=&#39;./doc/fonts/simfang.ttf&#39;, warmup=True)
</span></span></code></pre></div><p>Then, call the labels inference function as follows:</p><p>(Imgpath is the path to the image. You can also input a numpy array.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Imgpath</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>extr</span><span class=o>.</span><span class=n>inference</span><span class=p>(</span><span class=n>Imgpath</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;labels&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>If mode =&lsquo;labels&rsquo;, the inference function returns a dictionary with the detected labels.</p><p>If mode = &lsquo;graph&rsquo;, the inference function also displays the digitized HR graph while returning a dictionary. (Inference times may be slightly higher)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Display Results</span>
</span></span><span class=line><span class=cl><span class=n>results</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#39;SPO2&#39;: &#39;100&#39;, &#39;SBP&#39;: &#39;104&#39;, &#39;HR&#39;: &#39;62&#39;, &#39;DBP&#39;: &#39;79&#39;, &#39;MAP&#39;: &#39;88&#39;, &#39;RR&#39;: &#39;12&#39;}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Graph mode shows a graph and returns a dictionary</span>
</span></span><span class=line><span class=cl><span class=n>graph_mode</span><span class=o>=</span><span class=n>extr</span><span class=o>.</span><span class=n>inference</span><span class=p>(</span><span class=n>Imgpath</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;graph&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>graph_mode</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#39;SPO2&#39;: &#39;100&#39;, &#39;SBP&#39;: &#39;104&#39;, &#39;HR&#39;: &#39;62&#39;, &#39;DBP&#39;: &#39;79&#39;, &#39;MAP&#39;: &#39;88&#39;, &#39;RR&#39;: &#39;12&#39;}
</span></span></code></pre></div><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=./index_19_1.png alt=png loading=lazy data-zoomable></div></div></figure></p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=./index_19_2.png alt=png loading=lazy data-zoomable></div></div></figure></p></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F&amp;text=Code+for+inference+in+Vitals+Extraction+Chaallenge" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F&amp;t=Code+for+inference+in+Vitals+Extraction+Chaallenge" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Code%20for%20inference%20in%20Vitals%20Extraction%20Chaallenge&amp;body=https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F&amp;title=Code+for+inference+in+Vitals+Extraction+Chaallenge" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Code+for+inference+in+Vitals+Extraction+Chaallenge%20https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fmadhaviit.github.io%2Fmadhavk18%2Fpost%2Fvitals_notebook%2F&amp;title=Code+for+inference+in+Vitals+Extraction+Chaallenge" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://madhaviit.github.io/madhavk18><img class="avatar mr-3 avatar-circle" src=/madhavk18/authors/admin/avatar_hu7601307bef2afcede6c0b762314fae36_240613_270x270_fill_lanczos_center_3.png alt="Madhav Kadam"></a><div class=media-body><h5 class=card-title><a href=https://madhaviit.github.io/madhavk18>Madhav Kadam</a></h5><h6 class=card-subtitle>Computer Science Undergrad @IITI</h6><p class=card-text>I am wildly interested in research in Data Science and its applications.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/mkiitind target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.co.uk/citations?user=sIwtMXoAAAAJ" target=_blank rel=noopener><i class="fas fa-graduation-cap"></i></a></li><li><a href=https://github.com/madhaviit target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://www.linkedin.com/in/madhav-kadam/ target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a href=/madhavk18/uploads/resume.pdf><i class="ai ai-cv"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text"> 2023 Me. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a>  the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/madhavk18/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/madhavk18/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/madhavk18/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/madhavk18/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>